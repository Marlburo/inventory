{% extends "core/core_base.html" %}
{% block head %}
    <script src="{{ MEDIA_URL }}js/jquery-ui-1.8.11.custom.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/static/css/smoothness/jquery-ui-1.8.11.custom.css" type="text/css" />
    <script src="{{ MEDIA_URL }}javascripts/jquery.tablesorter/jquery.tablesorter.js" type="text/javascript"></script>
{% endblock %}
{% block core_content %}

<style type="text/css">
.center{
    text-align: center;
}
div advanced-search-knobs input{
    display:inline;
}

</style>
<script type="text/javascript">
    $(document).ready(function() {
        function get_and_display_search(){
            search = document.getElementById('id_search').value;
            window.location.hash = '#q='+search;
            // First make the banner go away. Then push everthing to the left... just like google.
            $('#banner_text').empty();
            //$('#results').html('');
            $('#banner_area').css('text-align', 'left');
            $('.banner').css('margin-bottom', '10px');
            $('#btn_i').remove();
            $('#results').html("<img id='loading' style='margin-top:5%;margin-bottom:2%;display:block;' src='{{MEDIA_URL}}images/loading.gif'>");
            var start = new Date().getTime();

            // We might want to abort this.
            $('#stop_search').css('display', 'inline');
            var search_request = $.get('/core/search/search_ajax?search='+escape(search),
                function update_results(data){
                    $('#stop_search').css('display', 'none');
                    results = document.getElementById('results');
                    results.innerHTML = data;
                    // Every table needs to have it's feilds configured.
                    $(".system-table").tablesorter({
                        headers: {
                            0: { sorter:'hostname' },
                            1: { sorter:'ipAddress' },
                        }
                    });
                    $(".record-table").tablesorter({
                        headers: {
                            0: { sorter:'hostname' },
                            1: { sorter:false },
                            2: { sorter:'hostname' },
                        }
                    });
                    $(".intr-table").tablesorter({
                        headers: {
                            0: { sorter:'hostname' },
                            1: { sorter:false },
                            2: { sorter:'ipAddress' },
                        }
                    });
                    $(".ptr-table").tablesorter({
                        headers: {
                            0: { sorter:'ipAddress' },
                            1: { sorter:false },
                            2: { sorter:'hostname' },
                        }
                    });
                    $(".addr-table").tablesorter({
                        headers: {
                            1: { sorter:false },
                            2: { sorter:'ipAddress' },
                        }
                    });

                    var end = new Date().getTime();
                    var time = end - start;
                    $('#search-time').html('In ('+time/1000+' seconds)');
            });
            $('#stop_search').click(function (){
                search_request.abort();
            });
        }

        $('#btn_s').click(function (){
                get_and_display_search();
        });
        $('#btn_i').click(function (){
                get_and_display_search();
        });
        $('#advanced_button').click(function (){
            $('#advanced-search-knobs').toggle();
        });
        // hash, we use that data as the initial data.
        var prmarr = window.location.hash.split('&');
        console.log(window.location.hash);
        var params = window.location.hash.substr(3)
        if ( params != ""){
            $('#id_search').attr('value', params);
            get_and_display_search();
        }
    });
</script>
<div id="banner_area" class="banner center">
    <div id='banner_text'><h1>Inventory</h1></div>
    <input class='search_tools' id="id_search" type="text" size="50" name="search" value="{{ search }}" autofocus="autofocus" style='margin-bottom; 20px'>
    <div style='display:block;'></div>
    <input class='search_tools' value="Search" title="Search" type="button" id="btn_s">
    <input value="I'm Feeling Lucky" title="I'm Feeling Lucky" name="lucky" type="submit" id="btn_i">
    <input class='search_tools' value="Help" title="Help" type="button" id="help_button">
    <input class='search_tools' value="Advanced Search" title="Advanced Search" type="button" id="advanced_button">
    <div id='advanced-search-knobs' style="display:none;">
        <div id='selectors'>
            <label for='A_f'>A/AAAA: <input type='checkbox' id='A_f'/></label>
            <label for='CNAME_f'>CNAME: <input type='checkbox' id='CNAME_f'/></label>
            <label for='Domain_f'>Domain: <input type='checkbox' id='Domain_f'/></label>
            <label for='INTR_f'>INTR: <input type='checkbox' id='INTR_f'/></label>
            <label for='System_f'>System: <input type='checkbox' id='System_f'/></label>
            <label for='MX_f'>MX: <input type='checkbox' id='MX_f'/></label>
            <label for='NS_f'>NS: <input type='checkbox' id='NS_f'/></label>
            <label for='PTR_f'>PTR: <input type='checkbox' id='PTR_f'/></label>
            <label for='SRV_f'>SRV: <input type='checkbox' id='SRV_f'/></label>
            <label for='TXT_f'>TXT: <input type='checkbox' id='TXT_f'/></label>
        </div>
        <div id='network-select'>
        </div>
        <div id='site-select'>
        </div>
        <div id='vlan-select'>
        </div>
    </div>
</div>
<div id="results" width="100%">
</div>
<input class='search_tools' value="Stop Search" title="Stop Search" type="button" id="stop_search" style="display:none;">
{% include 'search/core_search_help.html' %}
{% endblock %}
